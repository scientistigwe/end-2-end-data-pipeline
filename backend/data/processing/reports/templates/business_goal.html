{  # backend/data_pipeline/reporting/templates/business_goal.html #}
    { % extends
"base.html" %}

{ % block
extra_styles %}
< style >
.form - section
{
    background: var(--surface - color);
border - radius: 8
px;
padding: 2
rem;
margin - bottom: 2
rem;
box - shadow: 0
2
px
4
px
rgba(0, 0, 0, 0.05);
}

.section - number
{
    display: inline - block;
width: 32
px;
height: 32
px;
line - height: 32
px;
text - align: center;
background: var(--primary - color);
color: white;
border - radius: 50 %;
margin - right: 1
rem;
}

.form - group
{
    margin - bottom: 1.5rem;
}

.form - label
{
    display: block;
font - weight: 500;
margin - bottom: 0.5
rem;
color: var(--text - color);
}

.form - hint
{
    font - size: 0.875rem;
color: var(--secondary - color);
margin - bottom: 0.5
rem;
}

.form - control
{
    width: 100 %;
padding: 0.75
rem;
border: 1
px
solid  # e0e0e0;
border - radius: 4
px;
font - size: 1
rem;
transition: border - color
0.2
s;
}

.form - control: focus
{
    border - color: var(--primary - color);
outline: none;
box - shadow: 0
0
0
2
px
rgba(26, 115, 232, 0.1);
}

.domain - selector
{
    display: grid;
grid - template - columns: repeat(auto - fit, minmax(150
px, 1
fr));
gap: 1
rem;
margin - bottom: 1
rem;
}

.domain - option
{
    padding: 1rem;
border: 1
px
solid  # e0e0e0;
border - radius: 4
px;
text - align: center;
cursor: pointer;
transition: all
0.2
s;
}

.domain - option: hover
{
    border - color: var(--primary - color);
background: rgba(26, 115, 232, 0.05);
}

.domain - option.selected
{
    border - color: var(--primary - color);
background: rgba(26, 115, 232, 0.1);
}

.domain - icon
{
    font - size: 2rem;
margin - bottom: 0.5
rem;
color: var(--primary - color);
}

.column - mapper
{
    margin - top: 1rem;
}

.column - row
{
    display: flex;
align - items: center;
margin - bottom: 0.5
rem;
padding: 0.5
rem;
background:  # f8f9fa;
border - radius: 4
px;
}

.column - name
{
    flex: 1;
}

.column - type
{
    width: 150px;
}

.column - purpose
{
    width: 200px;
margin - left: 1
rem;
}

.metrics - grid
{
    display: grid;
grid - template - columns: repeat(auto - fit, minmax(250
px, 1
fr));
gap: 1
rem;
margin - top: 1
rem;
}

.metric - card
{
    border: 1px solid  # e0e0e0;
    border - radius: 4px;
padding: 1
rem;
}

.metric - card
input[type = "checkbox"] {
    margin - right: 0.5rem;
}

.analysis - options
{
    display: grid;
grid - template - columns: repeat(auto - fit, minmax(200
px, 1
fr));
gap: 1
rem;
margin - top: 1
rem;
}

.analysis - option
{
    border: 1px solid  # e0e0e0;
    border - radius: 4px;
padding: 1
rem;
cursor: pointer;
}

.analysis - option: hover
{
    border - color: var(--primary - color);
background: rgba(26, 115, 232, 0.05);
}

.analysis - option.selected
{
    border - color: var(--primary - color);
background: rgba(26, 115, 232, 0.1);
}

.tag - input
{
    display: flex;
flex - wrap: wrap;
gap: 0.5
rem;
padding: 0.5
rem;
border: 1
px
solid  # e0e0e0;
border - radius: 4
px;
}

.tag
{
    display: inline - flex;
align - items: center;
padding: 0.25
rem
0.5
rem;
background:  # e8eaed;
border - radius: 16
px;
font - size: 0.875
rem;
}

.tag.remove
{
    margin - left: 0.5rem;
cursor: pointer;
}

.visualization - grid
{
    display: grid;
grid - template - columns: repeat(auto - fit, minmax(150
px, 1
fr));
gap: 1
rem;
margin - top: 1
rem;
}

.viz - option
{
    text - align: center;
padding: 1
rem;
border: 1
px
solid  # e0e0e0;
border - radius: 4
px;
cursor: pointer;
}

.viz - option
img
{
    width: 100 %;
max - width: 100
px;
margin - bottom: 0.5
rem;
}

.constraints - list
{
    margin - top: 1rem;
}

.constraint - item
{
    display: flex;
align - items: center;
margin - bottom: 0.5
rem;
}

.constraint - item
input[type = "text"] {
    flex: 1;
margin - right: 0.5
rem;
}

.add - constraint
{
    margin - top: 0.5rem;
}

.actions - grid
{
    display: grid;
grid - template - columns: repeat(auto - fit, minmax(200
px, 1
fr));
gap: 1
rem;
margin - top: 1
rem;
}

.action - card
{
    border: 1px solid  # e0e0e0;
    border - radius: 4px;
padding: 1
rem;
}

.action - priority
{
    float: right;
padding: 0.25
rem
0.5
rem;
border - radius: 4
px;
font - size: 0.875
rem;
}

.priority - high
{
    background:  # fce8e6;
        color: var(--error - color);
}

.priority - medium
{
    background:  # fef7e0;
        color: var(--warning - color);
}

.priority - low
{
    background:  # e6f4ea;
        color: var(--success - color);
}

@media(max - width

: 768
px) {
    .form - section
{
    padding: 1rem;
}

.domain - selector
{
    grid - template - columns: repeat(auto - fit, minmax(120px, 1
fr));
}

.column - row
{
    flex - direction: column;
gap: 0.5
rem;
}

.column - type,
.column - purpose
{
    width: 100 %;
margin - left: 0;
}
}
< / style >
    { % endblock %}

{ % block
content %}
< form
id = "businessGoalForm"


class ="goal-form" >

< !-- 1.
Data
Context -->
< div


class ="form-section" >

< h2 > < span


class ="section-number" > 1 < / span > Data Context < / h2 >

< !-- Domain
Selection -->
< div


class ="form-group" >

< label


class ="form-label" > Select Your Domain < / label >

< div


class ="domain-selector" >


{ %
for domain in domains %}
< div


class ="domain-option" data-domain="{{ domain.id }}" >

< div


class ="domain-icon" > {{domain.icon}} < / div >

< div > {{domain.name}} < / div >
< / div >
{ % endfor %}
< / div >
< / div >

< !-- Dataset
Overview -->
< div


class ="form-group" >

< label


class ="form-label" > Dataset Overview < / label >

< div


class ="form-hint" > Briefly describe your dataset and its purpose < / div >

< textarea


class ="form-control" name="datasetOverview" rows="3"


placeholder = "Example: The dataset contains monthly sales data, including columns for product type, region, sales amount, and profit margin." > < / textarea >
< / div >

< !-- Column
Mapping -->
< div


class ="form-group" >

< label


class ="form-label" > Key Columns Mapping < / label >

< div


class ="form-hint" > Map your columns to their business purpose < / div >

< div


class ="column-mapper" >


{ %
for column in columns %}
< div


class ="column-row" >

< div


class ="column-name" > {{column.name}} < / div >

< select


class ="column-type form-control" >

< option
value = "" > Select
Type < / option >
{ %
for type in column_types %}
< option
value = "{{ type.id }}" > {{type.name}} < / option >
{ % endfor %}
< / select >
< input
type = "text"


class ="column-purpose form-control"


placeholder = "Business purpose" >
< / div >
{ % endfor %}
< / div >
< / div >
< / div >

< !-- 2.
Business / Data
Objective -->
< div


class ="form-section" >

< h2 > < span


class ="section-number" > 2 < / span > Business Objective < / h2 >

< !-- Primary
Questions -->
< div


class ="form-group" >

< label


class ="form-label" > What questions are you trying to answer? < / label >

< div


class ="form-hint" > List the key questions you want to address < / div >

< div


class ="tag-input" id="questionsTags" >

< input
type = "text"


class ="form-control"


placeholder = "Type a question and press Enter" >
< / div >
< / div >

< !-- Required
Insights -->
< div


class ="form-group" >

< label


class ="form-label" > What specific insights do you need? < / label >

< div


class ="form-hint" > Describe the insights that would be most valuable < / div >

< textarea


class ="form-control" name="requiredInsights" rows="3"


placeholder = "Example: Identify underperforming regions and recommend improvement strategies" > < / textarea >
< / div >
< / div >

< !-- 3.
Metrics
of
Interest -->
< div


class ="form-section" >

< h2 > < span


class ="section-number" > 3 < / span > Metrics of Interest < / h2 >

< !-- KPI
Selection -->
< div


class ="form-group" >

< label


class ="form-label" > Select Relevant Metrics / KPIs < / label >

< div


class ="metrics-grid" >


{ %
for metric in metrics %}
< div


class ="metric-card" >

< label >
< input
type = "checkbox"
name = "metrics[]"
value = "{{ metric.id }}" >
{{metric.name}}
< / label >
< div


class ="form-hint" > {{metric.description}} < / div >

< / div >
{ % endfor %}
< / div >
< / div >

< !-- Metric
Grouping -->
< div


class ="form-group" >

< label


class ="form-label" > How should these metrics be grouped? < / label >

< div


class ="tag-input" id="groupingTags" >

< input
type = "text"


class ="form-control"


placeholder = "Add grouping criteria (e.g., by region, by product)" >
< / div >
< / div >
< / div >

< !-- 4.
Analytical
Focus -->
< div


class ="form-section" >

< h2 > < span


class ="section-number" > 4 < / span > Analytical Focus < / h2 >

< !-- Analysis
Types -->
< div


class ="form-group" >

< label


class ="form-label" > Select Analysis Types < / label >

< div


class ="analysis-options" >


{ %
for analysis in analysis_types %}
< div


class ="analysis-option" data-type="{{ analysis.id }}" >

< h4 > {{analysis.name}} < / h4 >
< div


class ="form-hint" > {{analysis.description}} < / div >

< / div >
{ % endfor %}
< / div >
< / div >
< / div >

< !-- 5.
Output
Requirements -->
< div


class ="form-section" >

< h2 > < span


class ="section-number" > 5 < / span > Output Requirements < / h2 >

< !-- Format
Selection -->
< div


class ="form-group" >

< label


class ="form-label" > Select Output Formats < / label >


{ %
for format in output_formats %}
< label


class ="metric-card" >

< input
type = "checkbox"
name = "formats[]"
value = "{{ format.id }}" >
{{format.name}}
< div


class ="form-hint" > {{format.description}} < / div >

< / label >
{ % endfor %}
< / div >

< !-- Visualization
Selection -->
< div


class ="form-group" >

< label


class ="form-label" > Select Required Visualizations < / label >

< div


class ="visualization-grid" >


{ %
for viz in visualizations %}
< div


class ="viz-option" data-viz="{{ viz.id }}" >

< img
src = "{{ viz.preview }}"
alt = "{{ viz.name }}" >
< div > {{viz.name}} < / div >
< / div >
{ % endfor %}
< / div >
< / div >
< / div >

< !-- 6.
Constraints -->
< div


class ="form-section" >

< h2 > < span


class ="section-number" > 6 < / span > Constraints & Assumptions < / h2 >

< div


class ="form-group" >

< label


class ="form-label" > List Known Constraints or Assumptions < / label >

< div


class ="constraints-list" >

< div


class ="constraint-item" >

< input
type = "text"


class ="form-control"


placeholder = "Enter a constraint or assumption" >
< button
type = "button"


class ="remove-constraint" > Remove < / button >

< / div >
< / div >
< button
type = "button"


class ="add-constraint" > Add More < / button >

< / div >
< / div >

< !-- 7.
Desired
Outcomes -->
< div


class ="form-section" >

< h2 > < span


class ="section-number" > 7 < / span > Desired Outcomes < / h2 >

< !-- Actions
Grid -->
< div


class ="form-group" >

< label


class ="form-label" > What actions will be taken based on insights? < / label >

< div


class ="actions-grid" >

< div


class ="action-card" >

< span


class ="action-priority priority-high" > High Priority < / span >

< input
type = "text"


class ="form-control"


placeholder = "Enter desired action" >
< / div >
< button
type = "button"


class ="add-action" > Add Action < / button >

< / div >
< / div >

< !-- Success
Criteria -->
< div


class ="form-group" >

< label


class ="form-label" > Define Success Criteria < / label >

< div


class ="form-hint" > What metrics or outcomes would indicate success? < / div >

< div


class ="success-criteria" >

< div


class ="metric-row" >

< input
type = "text"


class ="form-control" placeholder="Metric name" >

< input
type = "text"


class ="form-control" placeholder="Target value" >

< select


class ="form-control" >

< option
value = "increase" > Increase < / option >
< option
value = "decrease" > Decrease < / option >
< option
value = "maintain" > Maintain < / option >
< / select >
< / div >
< button
type = "button"


class ="add-metric" > Add Another Metric < / button >

< / div >
< / div >
< / div >

< !-- Submit
Section -->
< div


class ="form-section submit-section" >

< div


class ="form-group" >

< button
type = "submit"


class ="submit-button" > Generate Analysis Plan < / button >

< button
type = "button"


class ="save-draft" > Save as Draft < / button >

< / div >
< / div >
< / form >
{ % endblock %}

{ % block
scripts %}
< script >
document.addEventListener('DOMContentLoaded', function()
{
// Domain
Selection
const
domainOptions = document.querySelectorAll('.domain-option');
domainOptions.forEach(option= > {
    option.addEventListener('click', function()
{
    domainOptions.forEach(opt= > opt.classList.remove('selected'));
this.classList.add('selected');
loadDomainSpecificFields(this.dataset.domain);
});
});

// Tag
Input
Management
function
setupTagInput(container)
{
    const
input = container.querySelector('input');
input.addEventListener('keydown', function(e)
{
if (e.key === 'Enter' & & this.value.trim()) {
    e.preventDefault();
addTag(container, this.value.trim());
this.value = '';
}
});
}

function
addTag(container, text)
{
    const
tag = document.createElement('div');
tag.className = 'tag';
tag.innerHTML = `
${text} \
 < span


class ="remove" > & times; < / span >


`;
tag.querySelector('.remove').addEventListener('click', () = > tag.remove());
container.insertBefore(tag, container.querySelector('input'));
}

// Setup
all
tag
inputs
document.querySelectorAll('.tag-input').forEach(setupTagInput);

// Analysis
Options
Selection
const
analysisOptions = document.querySelectorAll('.analysis-option');
analysisOptions.forEach(option= > {
    option.addEventListener('click', function()
{
    this.classList.toggle('selected');
updateAnalysisRequirements();
});
});

// Visualization
Selection
const
vizOptions = document.querySelectorAll('.viz-option');
vizOptions.forEach(option= > {
    option.addEventListener('click', function()
{
    this.classList.toggle('selected');
});
});

// Constraints
Management
const
addConstraintBtn = document.querySelector('.add-constraint');
addConstraintBtn.addEventListener('click', function()
{
    const
constraintsList = document.querySelector('.constraints-list');
const
newConstraint = document.createElement('div');
newConstraint.className = 'constraint-item';
newConstraint.innerHTML = `
                          < input
type = "text"


class ="form-control" placeholder="Enter a constraint or assumption" >

< button
type = "button"


class ="remove-constraint" > Remove < / button >


`;
constraintsList.appendChild(newConstraint);

newConstraint.querySelector('.remove-constraint').addEventListener('click', function()
{
    newConstraint.remove();
});
});

// Success
Criteria
Management
const
addMetricBtn = document.querySelector('.add-metric');
addMetricBtn.addEventListener('click', function()
{
const
successCriteria = document.querySelector('.success-criteria');
const
newMetric = document.createElement('div');
newMetric.className = 'metric-row';
newMetric.innerHTML = `
< input
type = "text"


class ="form-control" placeholder="Metric name" >

< input
type = "text"


class ="form-control" placeholder="Target value" >

< select


class ="form-control" >

< option
value = "increase" > Increase < / option >
< option
value = "decrease" > Decrease < / option >
< option
value = "maintain" > Maintain < / option >
< / select >
< button
type = "button"


class ="remove-metric" > Remove < / button >


`;
successCriteria.insertBefore(newMetric, addMetricBtn);

newMetric.querySelector('.remove-metric').addEventListener('click', function()
{
    newMetric.remove();
});
});

// Form
Submission
const
form = document.getElementById('businessGoalForm');
form.addEventListener('submit', async function(e)
{
e.preventDefault();

// Collect
form
data
const
formData = {
    domain: document.querySelector('.domain-option.selected')?.dataset.domain,
datasetOverview: document.querySelector('[name="datasetOverview"]').value,
columns: Array.
from

(document.querySelectorAll('.column-row')).map(row= > ({
    name: row.querySelector('.column-name').textContent,
    type: row.querySelector('.column-type').value,
    purpose: row.querySelector('.column-purpose').value
})),
questions: Array.
from

(document.querySelector('#questionsTags').querySelectorAll('.tag'))
.map(tag= > tag.textContent.trim()),
insights: document.querySelector('[name="requiredInsights"]').value,
metrics: Array.
from

(document.querySelectorAll('input[name="metrics[]"]:checked'))
.map(input= > input.value),
groupings: Array.
from

(document.querySelector('#groupingTags').querySelectorAll('.tag'))
.map(tag= > tag.textContent.trim()),
analysisTypes: Array.
from

(document.querySelectorAll('.analysis-option.selected'))
.map(option= > option.dataset.type),
outputFormats: Array.
from

(document.querySelectorAll('input[name="formats[]"]:checked'))
.map(input= > input.value),
visualizations: Array.
from

(document.querySelectorAll('.viz-option.selected'))
.map(option= > option.dataset.viz),
constraints: Array.
from

(document.querySelectorAll('.constraint-item input'))
.map(input= > input.value.trim()).filter(Boolean),
successCriteria: Array.
from

(document.querySelectorAll('.metric-row')).map(row= > ({
    metric: row.querySelector('input:first-child').value,
    target: row.querySelector('input:nth-child(2)').value,
    direction: row.querySelector('select').value
}))
};

try {
// Send data to backend
const response = await fetch('/api/business-goals', {
method: 'POST',
headers: {
    'Content-Type': 'application/json'
},
body: JSON.stringify(formData)
});

if (!response.ok) {
throw new Error('Failed to submit form');
}

const result = await response.json();
// Handle success (e.g., redirect to analysis plan page)
window.location.href = ` / analysis-plan / ${result.planId}`;

} catch (error) {
console.error('Form submission failed:', error);
// Show error message to user
alert('Failed to submit form. Please try again.');
}
});

// Domain - specific
field
loading
function
loadDomainSpecificFields(domain)
{
// Load
domain - specific
metrics, analysis
types, and visualizations
fetch(` / api / domain - config /${domain}
`)
.then(response= > response.json())
.then(config= > {
    updateMetricsGrid(config.metrics);
updateAnalysisOptions(config.analysisTypes);
updateVisualizationOptions(config.visualizations);
})
.catch(error= > console.error('Failed to load domain config:', error));
}

function
updateMetricsGrid(metrics)
{
    const
metricsGrid = document.querySelector('.metrics-grid');
metricsGrid.innerHTML = metrics.map(metric= > `
< div


class ="metric-card" >

< label >
< input
type = "checkbox"
name = "metrics[]"
value = "${metric.id}" >
${metric.name}
< / label >
< div


class ="form-hint" > ${metric.description} < / div >

< / div >
`).join('');
}

function
updateAnalysisOptions(analysisTypes)
{
    const
analysisOptions = document.querySelector('.analysis-options');
analysisOptions.innerHTML = analysisTypes.map(analysis= > `
< div


class ="analysis-option" data-type="${analysis.id}" >

< h4 >${analysis.name} < / h4 >
< div


class ="form-hint" > ${analysis.description} < / div >

< / div >
`).join('');
}

function
updateVisualizationOptions(visualizations)
{
    const
vizGrid = document.querySelector('.visualization-grid');
vizGrid.innerHTML = visualizations.map(viz= > `
< div


class ="viz-option" data-viz="${viz.id}" >

< img
src = "${viz.preview}"
alt = "${viz.name}" >
< div >${viz.name} < / div >
< / div >
`).join('');
}

// Save
draft
functionality
document.querySelector('.save-draft').addEventListener('click', function()
{
const
formData = new
FormData(form);
localStorage.setItem('businessGoalDraft', JSON.stringify(Object.fromEntries(formData)));
alert('Draft saved successfully!');
});

// Load
draft if exists
const
savedDraft = localStorage.getItem('businessGoalDraft');
if (savedDraft)
{
    const
draftData = JSON.parse(savedDraft);
Object.entries(draftData).forEach(([key, value]) = > {
    const
element = form.querySelector(`[name = "${key}"]`);
if (element) {
element.value = value;
}
});
}
});
< / script >
{%endblock %}